<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta name="description" content="D7000">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Expires" content="Mon, 06 Jan 1990 00:00:01 GMT">
<title>NETGEAR Router D7000</title>
<link rel="stylesheet" href="style/form.css">
<style type="text/javascript">
	classes.num.all.fontFamily="Courier";
	classes.num.all.fontSize="10pt";
</style>
<script language="javascript" type="text/javascript" src="string.js"></script>
<script language="javascript" type="text/javascript" src="funcs.js"></script>
<script language="javascript" type="text/javascript" src="utility.js"></script>
<script language="javascript" type="text/javascript" src="linux.js"></script>
<script language="javascript" type="text/javascript">
<!--

function setDefs() {
	var cf=document.forms[0];

	if(cf.qos_enable.value=="") cf.qos_enable.checked=false;
	if(cf.qos_uplink_rate.value=="") cf.qos_uplink_rate.value="512";
	if(cf.qos_rate_unit.value=="") cf.qos_rate_unit.value="Kbps";
	if(cf.qos_dwlink_rate.value=="") cf.qos_dwlink_rate.value="0";
	if(cf.qos_rate_unit_dw.value=="") cf.qos_rate_unit_dw.value="Kbps";
		if(cf.h_qos_llayer.value=="") {
		if(cf.h_wan_traffic_type.value=="ptm") cf.qos_llayer.value="ethernet";
		else if(cf.h_wan_traffic_type.value=="atm") cf.qos_llayer.value="atm";
		else cf.qos_llayer.value="none";
		}
	if(cf.h_qos_disc.value=="") cf.qos_disc.value="fq_codel";
	if(cf.h_qos_shaper.value=="") cf.qos_shaper.value="htb";
	if(cf.h_qos_ignore_dscp_egress.value=="") cf.qos_ignore_dscp_egress.value="0";
	if(cf.h_qos_ignore_dscp_ingress.value=="") cf.qos_ignore_dscp_ingress.value="1";
	if(cf.h_qos_dserv_egress.value=="") cf.qos_dserv_egress.value="diffserv3";
	if(cf.h_qos_dserv_ingress.value=="") cf.qos_dserv_ingress.value="diffserv3";
	if(cf.h_qos_eecn.value=="") cf.qos_eecn.value="NOECN";
	if(cf.h_qos_iecn.value=="") cf.qos_iecn.value="ECN";
}

function loadCheck() {
	var cf=document.forms[0];

		if(cf.qos_disc.value=="fq_codel") {
		cf.qos_eecn.disabled=false;
		cf.qos_iecn.disabled=false;
		if(cf.qos_shaper.value=="hfsc") cf.qos_shaper.value="htb";
		cf.qos_shaper[1].disabled=true;
		}
		else {
		cf.qos_eecn.disabled=true;
		cf.qos_iecn.disabled=true;
		cf.qos_shaper[1].disabled=false;
		}
		if(cf.qos_shaper.value=="tbf") {
		cf.qos_dserv_egress.value="shaper";
		cf.qos_dserv_egress[1].disabled=true;
		cf.qos_dserv_egress[2].disabled=true;
		cf.qos_dserv_ingress.value="shaper";
		cf.qos_dserv_ingress[1].disabled=true;
		cf.qos_dserv_ingress[2].disabled=true;
		}
		else {
		cf.qos_dserv_egress[1].disabled=false;
		cf.qos_dserv_egress[2].disabled=false;
		cf.qos_dserv_ingress[1].disabled=false;
		cf.qos_dserv_ingress[2].disabled=false;
		}
		if(cf.qos_dserv_egress.value!="diffserv3") {
		cf.qos_ignore_dscp_egress.value="1";
		cf.qos_ignore_dscp_egress[1].disabled=true;
		}
		else cf.qos_ignore_dscp_egress[1].disabled=false;
		if(cf.qos_dserv_ingress.value!="diffserv3") {
		cf.qos_ignore_dscp_ingress.value="1";
		cf.qos_ignore_dscp_ingress[1].disabled=true;
		}
		else cf.qos_ignore_dscp_ingress[1].disabled=false;
}

function varInit() {

	AncdataToVisible(document.forms[0]);
	setDefs();
	loadCheck();
}

function rateUlChange() {
	var cf=document.forms[0];

	if(cf.qos_uplink_rate.value=="") cf.qos_uplink_rate.value="0";
	else if(cf.qos_rate_unit.value=="Mbps") cf.qos_uplink_rate.value=Math.floor(parseInt(cf.qos_uplink_rate.value)/1000);
	else cf.qos_uplink_rate.value=Math.floor(parseInt(cf.qos_uplink_rate.value)*1000);
}

function rateDlChange() {
	var cf=document.forms[0];

	if(cf.qos_dwlink_rate.value=="") cf.qos_dwlink_rate.value="0";
	else if(cf.qos_rate_unit_dw.value=="Mbps") cf.qos_dwlink_rate.value=Math.floor(parseInt(cf.qos_dwlink_rate.value)/1000);
	else cf.qos_dwlink_rate.value=Math.floor(parseInt(cf.qos_dwlink_rate.value)*1000);
}

function checkData() {
	var cf=document.forms[0];
	var msg="";
	var lim;

	if(cf.qos_rate_unit.value=="Mbps") lim=9999;
	else lim=999999;
	if(cf.qos_uplink_rate.value.length>1 && cf.qos_uplink_rate.value[0]=='0') msg+="Invalid Uplink bandwidth value";
	else msg+=checkInt(cf.qos_uplink_rate, "Uplink bandwidth", 0, lim, true);
	if(cf.qos_rate_unit_dw.value=="Mbps") lim=9999;
	else lim=999999;
	if(cf.qos_dwlink_rate.value.length>1 && cf.qos_dwlink_rate.value[0]=='0') msg+="Invalid Downlink bandwidth value";
	else msg+=checkInt(cf.qos_dwlink_rate, "Downlink bandwidth", 0, lim, true);
		if(cf.qos_script.value!="") {
		if(cf.qos_script.value.indexOf(".sqm")<0) msg+="Invalid qos script name: it must have \".sqm\" extension\n";
		if(!checkInvalidChars(cf.qos_script.value, invalid_folder_char)) msg+="Invalid qos script name: characters not allowed\n";
		}

	if(msg.length>1) {
	alert(msg);
	return false;
	}
	AncdataToHidden(cf);
	return true;
}

function checkPerscript() {
	var cf=document.forms['perscript'];
	var filename="";
	var destdir="/tmp/";
	var a;
	var IEPlfm = /MSIE [67]/g;
	var diskprefix = /^.:\\/g;

		if(typeof cf.download.files[0]!='undefined') filename=cf.download.files[0].name;
		else {
		alert(getErrorMsgByVar("gsm_msg_bku_no_blank_filename"));
		return false;
		}
		if(IEPlfm.test(navigator.userAgent) && !diskprefix.test(filename)) {
		alert(getErrorMsgByVar("gsm_msg_upg_inv_file_type")+"sqm");
		return false;
		}
	if(filename.split) a=filename.split(".");
	else a=cdisplit(filename,".");
		if((a.length<2) || (a[0]=="") || (a[a.length-1].toLowerCase()!="sqm")) {
		alert(getErrorMsgByVar("gsm_msg_upg_inv_file_type")+"sqm");
		return false;
		}

	if(!confirm("Installing personal qos script "+filename+" : proceed ?")) return false;
	cf.todo.value="/usr/sbin/mv -f "+destdir+filename+" /usr/sbin/scripts/; /usr/sbin/nvram set qos_script="+filename+" >/dev/null 2>&1";
	return true;
}

//-->
</script></head>
<body bgcolor="#ffffff" leftmargin="0" marginwidth="0" topmargin="0" marginheight="0" onload="varInit();document.forms[0].elements[0].focus();">
<form name="qossqm" method="POST" action="anc.cgi" onSubmit="buttonToDisabled(document.forms[0])">
<div><a class="page_title" href="javascript:gotoWiki('qos-sqm-package/');">QOS SQM</a></div>
<div class="fix_button">
<table border="0" cellpadding="0" cellspacing="2" width="100%"><tr><td nowrap colspan="2" align="center">
<input class="cancel_bt" type="reset" name="cancel" value="Cancel" onClick="setTimeout('varInit()',250)">
&nbsp;
<input class="common_bt" type="submit" name="resetqos" value="Reset" onClick="this.form.job.value='home';this.form.todo.value='/usr/sbin/rc_app/rc_qos reset';if(!confirm('Qos sqm settings are about to be unset: proceed ?')) return false;else return true">
&nbsp;
<input class="common_bt" type="button" name="details" value="Details" onClick="this.form.pipe_cmd.value='/usr/sbin/rc_app/rc_qos details';AncstdAction(this.form,'anc_run.htm','qos-sqm.htm','pipe','');">
&nbsp;
<input class="common_bt" type="button" name="stats" value="Stats" onClick="this.form.pipe_cmd.value='/usr/sbin/rc_app/rc_qos stats';AncstdAction(this.form,'anc_run.htm','qos-sqm.htm','pipe','');">
&nbsp;
<input class="apply_bt" type="submit" name="apply" value="Apply" onClick="return checkData()">
</td></tr></table>
</div>
<div id="main" class="main_top_button">
<table border="0" cellpadding="0" cellspacing="3" width="100%">
<tr><td nowrap colspan="2"><input type="checkbox" name="qos_enable" value="@h_qos_enable#"><a href="javascript:gotoWiki('qos-sqm-package#qos_enable');"><b>Turn QOS Service On</b></a></td></tr>
<tr><td colspan="2" background="liteblue.gif" height="12"></td></tr>
<tr><td nowrap><a href="javascript:gotoWiki('qos-sqm-package#qos_uplink_rate');"><b>Uplink Bandwidth</b></a></td>
<td nowrap align="right"><input type="text" class="num" name="qos_uplink_rate" value="@qos_uplink_rate#" size=6 maxlength=6>
&nbsp;	<select name="qos_rate_unit" onChange="rateUlChange()" size=1>
		<option value="Kbps">Kbps</option>
		<option value="Mbps">Mbps</option>
	</select>
</td></tr>
<tr><td nowrap><a href="javascript:gotoWiki('qos-sqm-package#qos_dwlink_rate');"><b>Downlink Bandwidth</b></a></td>
<td nowrap align="right"><input type="text" class="num" name="qos_dwlink_rate" value="@qos_dwlink_rate#" size=6 maxlength=6>
&nbsp;	<select name="qos_rate_unit_dw" onChange="rateDlChange()" size=1>
		<option value="Kbps">Kbps</option>
		<option value="Mbps">Mbps</option>
	</select>
</td></tr>
<tr><td colspan="2" background="liteblue.gif" height="12"></td></tr>
<tr><td align="left"><span><a href="javascript:gotoWiki('qos-sqm-package#qos_llayer');"><b>Dsl Link Layer</b></a></span></td>
	<td align="right"><select name="qos_llayer" size=1>
		<option value="ethernet">VDSL</option>
		<option value="atm">ADSL</option>
		<option value="none">Other (DEF)</option>
	</select>
</td></tr>
<tr><td colspan="2" background="liteblue.gif" height="12"></td></tr>
<tr><td align="left"><span><a href="javascript:gotoWiki('qos-sqm-package#qos_disc');"><b>Disc Algorithm</b></a></span></td>
	<td align="right"><select name="qos_disc" onChange="loadCheck()" size=1>
		<option value="fq_codel">Fq_Codel (DEF)</option>
		<option value="sfq">Sfq</option>
	</select>
</td></tr>
<tr><td align="left"><span><a href="javascript:gotoWiki('qos-sqm-package#qos_shaper');"><b>Shaper Algorithm</b></a></span></td>
	<td align="right"><select name="qos_shaper" onChange="loadCheck()" size=1>
		<option value="htb">Htb (DEF)</option>
		<option value="hfsc">Hfsc</option>
		<option value="tbf">Tbf</option>
	</select>
</td></tr>
<tr><td colspan="2" background="liteblue.gif" height="12"></td></tr>
<tr><td align="left"><span><a href="javascript:gotoWiki('qos-sqm-package#qos_dserv_egress');"><b>Uplink Prioritization Scheme</b></a></span></td>
	<td align="right"><select name="qos_dserv_egress" onChange="loadCheck()" size=1>
			<option value="shaper">Shaper Only</option>
			<option value="classful">Classful</option>
			<option value="diffserv3">Diffserv (DEF)</option>
	</select>
</td></tr>
<tr><td align="left"><span><a href="javascript:gotoWiki('qos-sqm-package#qos_dserv_ingress');"><b>Downlink Prioritization Scheme</b></a></span></td>
	<td align="right"><select name="qos_dserv_ingress" onChange="loadCheck()" size=1>
			<option value="shaper">Shaper Only</option>
			<option value="classful">Classful</option>
			<option value="diffserv3">Diffserv (DEF)</option>
	</select>
</td></tr>
<tr><td align="left"><span><a href="javascript:gotoWiki('qos-sqm-package#qos_ignore_dscp_egress');"><b>DSCP Uplink Filtering Classification</b></a></span></td>
	<td align="right"><select name="qos_ignore_dscp_egress" size=1>
			<option value="1">Undifferentiated Priority</option>
			<option value="0">N-Tier Priority (DEF)</option>
	</select>
</td></tr>
<tr><td align="left"><span><a href="javascript:gotoWiki('qos-sqm-package#qos_ignore_dscp_ingress');"><b>DSCP Downlink Filtering Classification</b></a></span></td>
	<td align="right"><select name="qos_ignore_dscp_ingress" size=1>
			<option value="1">Undifferentiated Priority (DEF)</option>
			<option value="0">N-Tier Priority</option>
	</select>
</td></tr>
<tr><td align="left"><span><a href="javascript:gotoWiki('qos-sqm-package#qos_eecn');"><b>Uplink Explicit Congestion Notification</b></a></span></td>
	<td align="right"><select name="qos_eecn" onChange="if(this.value=='ECN' && this.form.qos_rate_unit.value=='Kbps' && this.form.qos_uplink_rate.value<1000) alert('Warning ! Uplink bandwidth too low for ECN !\n')" size=1>
			<option value="ECN">ECN On (DEF)</option>
			<option value="NOECN">ECN Off</option>
	</select>
</td></tr>
<tr><td align="left"><span><a href="javascript:gotoWiki('qos-sqm-package#qos_iecn');"><b>Downlink Explicit Congestion Notification</b></a></span></td>
	<td align="right"><select name="qos_iecn" size=1>
			<option value="ECN">ECN On (DEF)</option>
			<option value="NOECN">ECN Off</option>
	</select>
</td></tr>
<tr><td colspan="2" background="liteblue.gif" height="12"></td></tr>
<tr><td colspan="2" align="center"><a href="javascript:gotoWiki('qos-sqm-package#qos_script');" tabindex="-1"><b>Personal QOS Script Name</b></a></td></tr>
<tr><td colspan="2" align="center"><input type="text" class="text" name="qos_script" value="@qos_script#" size="40" maxlength="128"></td></tr>
</table>
<input type="hidden" name="job" value="save">
<input type="hidden" name="todo" value="/usr/sbin/rc qos start">
<input type="hidden" name="next_file" value="qos-sqm.htm">
<input type="hidden" name="old_file" value="">
<input type="hidden" name="pipe_cmd" value="">
<input type="hidden" name="h_qos_enable" value="@h_qos_enable#">
<input type="hidden" name="h_qos_rate_unit" value="@h_qos_rate_unit#">
<input type="hidden" name="h_qos_rate_unit_dw" value="@h_qos_rate_unit_dw#">
<input type="hidden" name="h_qos_llayer" value="@h_qos_llayer#">
<input type="hidden" name="h_qos_disc" value="@h_qos_disc#">
<input type="hidden" name="h_qos_shaper" value="@h_qos_shaper#">
<input type="hidden" name="h_qos_dserv_egress" value="@h_qos_dserv_egress#">
<input type="hidden" name="h_qos_dserv_ingress" value="@h_qos_dserv_ingress#">
<input type="hidden" name="h_qos_ignore_dscp_egress" value="@h_qos_ignore_dscp_egress#">
<input type="hidden" name="h_qos_ignore_dscp_ingress" value="@h_qos_ignore_dscp_ingress#">
<input type="hidden" name="h_qos_eecn" value="@h_qos_eecn#">
<input type="hidden" name="h_qos_iecn" value="@h_qos_iecn#">
<input type="hidden" name="h_wan_traffic_type" value="@h_wan_traffic_type#">
</form>
<form name="perscript" method="POST" action="anc.cgi" enctype="multipart/form-data" onSubmit="buttonToDisabled(document.forms[0])">
<table border="0" cellpadding="0" cellspacing="3" width="100%">
<tr><td colspan="2" align="center"><a href="javascript:gotoWiki('qos-sqm-package#qos_script')" tabindex="-1"><b>Install a Personal QOS Script</b></a></td></tr>
<tr><td colspan="2" align="center"><input type="FILE" name="download" size="40" maxlength="128" value=""></td></tr>
<tr><td colspan="2" align="center"><input class="apply_bt" type="submit" name="install" value="Install" onClick="return checkPerscript();"></td></tr>
<tr><td colspan="2" background="liteblue.gif" height="12"></td></tr></table>
<input type="hidden" name="job" value="home">
<input type="hidden" name="todo" value="">
<input type="hidden" name="next_file" value="qos-sqm.htm">
</form></div>
<script>printHelp();</script>
</body></html>
